# Implementation Plan: Frontend — Pages + Components + API Client

**Branch**: `008-testing-strategy` | **Date**: 2026-02-08 | **Specs**: 001-system-architecture, 003-auth-system, 005-task-crud-features, 006-frontend-pages, 007-frontend-components
**Input**: User request for complete Next.js 16+ frontend implementation. Backend API is already implemented with 6 REST endpoints.

## Summary

Implement the complete Next.js 16+ frontend: API client with JWT authentication, 4 pages (root redirect, login, signup, dashboard), 7 interactive components (TaskList, TaskItem, TaskForm, TaskFilter, LoginForm, SignupForm, Navbar), protected route layout, TypeScript types, and all loading/error/empty states. All data flows through the backend API via JWT-authenticated requests.

## Technical Context

**Language/Version**: TypeScript (frontend, Next.js 16.1.6, React 19.2.3)
**Primary Dependencies**: next@16.1.6, better-auth@^1.4.18, pg@^8.18.0, tailwindcss@^4
**Auth**: Better Auth with JWT plugin (already configured: `lib/auth.ts`, `lib/auth-client.ts`, `hooks/useAuth.ts`, `app/api/auth/[...all]/route.ts`)
**Storage**: Backend API at `NEXT_PUBLIC_API_URL` (default `http://localhost:8000`)
**Target Platform**: Web (localhost dev, Vercel deploy)
**Project Type**: Web (monorepo: `frontend/` directory)
**Performance Goals**: Pages load < 3 seconds, API responses render < 1 second, filter/sort < 500ms
**Constraints**: Hackathon scope, no external component libraries, Tailwind utility classes only, no separate stylesheets

## Constitution Check

*GATE: Must pass before implementation.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. Spec-Driven Development | PASS | Specs 001, 003, 005, 006, 007 all committed |
| II. No Manual Coding | PASS | All code generated by frontend + auth agents from this plan |
| III. User Isolation | PASS | API client sends user_id from session; backend enforces |
| IV. Clean Architecture | PASS | Centralized API client, no direct fetch in components, thin pages |
| V. Monorepo Coherence | PASS | Backend API already implemented; frontend calls it via REST |

---

## Phase 0: Research

### R-001: Better Auth token retrieval method

- **Decision**: Use `authClient.token()` which returns `{ data: { token } }`
- **Rationale**: Already implemented in `hooks/useAuth.ts:20-21` and working. The SKILL.md says `getToken()` but the actual implementation uses `authClient.token()`.
- **Alternatives**: `authClient.getToken()` — listed in SKILL.md but not what was implemented in foundation layer.

### R-002: API client pattern for JWT-authenticated requests

- **Decision**: Create `lib/api.ts` with `fetchWithAuth()` helper and `api` object with typed methods
- **Rationale**: Spec FR-014 (006-frontend-pages) and constitution Code Quality mandate a single API client module. The auth SKILL.md already provides the exact pattern.
- **Alternatives**: SWR/React Query — adds dependency, overkill for hackathon scope.

### R-003: Protected route pattern for dashboard

- **Decision**: Client-side layout with `useAuth()` hook + `useEffect` redirect
- **Rationale**: Better Auth session is client-side (cookie-based). The auth SKILL.md provides this exact pattern. Using `"use client"` layout for dashboard.
- **Alternatives**: Middleware-based protection — requires server-side session check which adds complexity with Better Auth.

### R-004: Delete response handling (204 No Content)

- **Decision**: `fetchWithAuth` must handle 204 responses (no JSON body). Return `null` or skip `.json()` for 204.
- **Rationale**: Backend DELETE endpoint returns 204 with no body. Calling `.json()` on a 204 will throw.
- **Alternatives**: Change backend to return 200 — breaks spec.

### R-005: Task type definitions

- **Decision**: Create `types/task.ts` matching backend `TaskResponse` schema exactly.
- **Rationale**: TypeScript strict mode requires proper types. Backend schema: `{ id: number, user_id: string, title: string, description: string | null, completed: boolean, created_at: string, updated_at: string }`.
- **Alternatives**: None — type safety is non-negotiable per constitution.

---

## Phase 1: Design & Contracts

### Data Model

#### Task (Frontend TypeScript interface, matches backend TaskResponse)

```typescript
interface Task {
  id: number;
  user_id: string;
  title: string;
  description: string | null;
  completed: boolean;
  created_at: string;  // ISO 8601 datetime from backend
  updated_at: string;
}

interface TaskCreateData {
  title: string;
  description?: string;
}

interface TaskUpdateData {
  title?: string;
  description?: string;
}
```

#### Filter State

```typescript
type StatusFilter = "all" | "pending" | "completed";
type SortOption = "created" | "title";
```

### API Contract (Frontend → Backend)

All requests require `Authorization: Bearer <jwt_token>` header.
Base URL: `NEXT_PUBLIC_API_URL` (default `http://localhost:8000`).

| Method | Path | Request Body | Response | Status |
|--------|------|-------------|----------|--------|
| GET | `/api/{user_id}/tasks?status={filter}&sort={sort}` | — | `Task[]` | 200 |
| POST | `/api/{user_id}/tasks` | `TaskCreateData` | `Task` | 201 |
| GET | `/api/{user_id}/tasks/{id}` | — | `Task` | 200 |
| PUT | `/api/{user_id}/tasks/{id}` | `TaskUpdateData` | `Task` | 200 |
| DELETE | `/api/{user_id}/tasks/{id}` | — | — | 204 |
| PATCH | `/api/{user_id}/tasks/{id}/complete` | — | `Task` | 200 |

### Component Tree

```
app/layout.tsx (Server Component — root layout, fonts, globals.css)
├── app/page.tsx (Server Component — redirect to /dashboard or /login)
├── app/login/page.tsx (Server Component — renders LoginForm)
├── app/signup/page.tsx (Server Component — renders SignupForm)
└── app/dashboard/layout.tsx (Client Component — auth guard)
    └── app/dashboard/page.tsx (Client Component — orchestrates all dashboard components)
        ├── Navbar (Client Component — user info + logout)
        ├── TaskForm (Client Component — create/edit mode)
        ├── TaskFilter (Client Component — status + sort controls)
        └── TaskList (Client Component — renders TaskItem[])
            └── TaskItem (Client Component — display + toggle/edit/delete)
```

### File Structure (New Files to Create)

```
frontend/
├── types/
│   └── task.ts                          # Task, TaskCreateData, TaskUpdateData, filter types
├── lib/
│   └── api.ts                           # fetchWithAuth + api object
├── components/
│   ├── Navbar.tsx                        # User identity + logout button
│   ├── LoginForm.tsx                     # Email + password + submit + error
│   ├── SignupForm.tsx                    # Name + email + password + submit + error
│   ├── TaskList.tsx                      # Loading/empty/error/populated states
│   ├── TaskItem.tsx                      # Single task display + actions
│   ├── TaskForm.tsx                      # Create/edit modes + validation
│   └── TaskFilter.tsx                    # Status filter + sort control
├── app/
│   ├── page.tsx                          # MODIFY: root redirect
│   ├── layout.tsx                        # MODIFY: update metadata
│   ├── not-found.tsx                     # NEW: 404 page
│   ├── login/
│   │   └── page.tsx                      # NEW: login page
│   ├── signup/
│   │   └── page.tsx                      # NEW: signup page
│   └── dashboard/
│       ├── layout.tsx                    # NEW: protected route layout
│       └── page.tsx                      # NEW: dashboard page
```

---

## Phase 2: Implementation Tasks

### Task 1: Create TypeScript type definitions
**File**: `frontend/types/task.ts`
**Agent**: Frontend
**Dependencies**: None

Create `Task`, `TaskCreateData`, `TaskUpdateData` interfaces and `StatusFilter`, `SortOption` type aliases matching the backend API contract exactly.

**Acceptance**: Types compile with strict mode. All fields match backend `TaskResponse` schema.

---

### Task 2: Create API client module
**File**: `frontend/lib/api.ts`
**Agent**: Frontend
**Dependencies**: Task 1 (types)

Implement:
- `fetchWithAuth(path, options)` — gets JWT via `authClient.token()`, attaches `Authorization: Bearer <token>`, handles 401 redirect to /login, handles 204 no-content (return null instead of parsing JSON), throws on non-OK responses with error detail
- `api` object with typed methods: `getTasks(userId, status?, sort?)`, `getTask(userId, taskId)`, `createTask(userId, data)`, `updateTask(userId, taskId, data)`, `deleteTask(userId, taskId)`, `toggleComplete(userId, taskId)`
- Import types from `@/types/task`

**Acceptance**: All 6 API methods match backend endpoint signatures. 204 responses handled. 401 triggers redirect. Errors throw with detail message.

---

### Task 3: Create LoginForm component
**File**: `frontend/components/LoginForm.tsx`
**Agent**: Frontend
**Dependencies**: None (uses useAuth hook)

`"use client"` component with:
- Email input (type="email", required)
- Password input (type="password", required)
- "Sign In" submit button
- Loading state: button disabled + spinner/text during request
- Error state: inline error message below form
- Link to /signup: "Don't have an account? Sign up"
- On success: `router.push("/dashboard")`
- Calls `signIn(email, password)` from `useAuth()`

**Acceptance**: Form validates required fields. Error displays inline. Button disabled during loading. Redirects on success.

---

### Task 4: Create SignupForm component
**File**: `frontend/components/SignupForm.tsx`
**Agent**: Frontend
**Dependencies**: None (uses useAuth hook)

`"use client"` component with:
- Name input (required)
- Email input (type="email", required)
- Password input (type="password", required, minLength=8)
- "Sign Up" submit button
- Loading state: button disabled + spinner/text
- Error state: inline error message (duplicate email, validation errors)
- Link to /login: "Already have an account? Sign in"
- On success: `router.push("/dashboard")`
- Calls `signUp(email, password, name)` from `useAuth()`

**Acceptance**: All 3 fields required. Password min 8 chars validated. Error displays inline. Redirects on success.

---

### Task 5: Create Navbar component
**File**: `frontend/components/Navbar.tsx`
**Agent**: Frontend
**Dependencies**: None (uses useAuth hook)

`"use client"` component with:
- Display user's name or email from session
- "Sign Out" button
- On signout: calls `signOut()` then `router.push("/login")`
- Tailwind styling: sticky top, flexbox, good visual hierarchy

**Acceptance**: Shows user identity. Logout works and redirects to /login.

---

### Task 6: Create TaskFilter component
**File**: `frontend/components/TaskFilter.tsx`
**Agent**: Frontend
**Dependencies**: Task 1 (types)

`"use client"` component with:
- Props: `statusFilter`, `sortOption`, `onStatusChange`, `onSortChange`
- Status filter buttons: All, Pending, Completed (active state highlighted)
- Sort control: Newest First, Alphabetical (active state highlighted)
- All Tailwind utility classes

**Acceptance**: Active filter/sort visually highlighted. onChange callbacks fire correctly. Default: All + Newest First.

---

### Task 7: Create TaskForm component
**File**: `frontend/components/TaskForm.tsx`
**Agent**: Frontend
**Dependencies**: Task 1 (types)

`"use client"` component with:
- Props: `mode: "create" | "edit"`, `initialData?: Task`, `onSubmit`, `onCancel?`
- Title input (required, max 200 chars)
- Description textarea (optional, max 1000 chars)
- Validation: empty title error, character limit errors
- Submit button: "Add Task" (create) / "Update Task" (edit)
- Cancel button (edit mode only)
- Loading state on submit button
- Error display if submission fails
- Clears form after successful create
- Preserves input on error

**Acceptance**: Validates title required + length limits. Two modes work correctly. Loading state shown. Form clears on create success.

---

### Task 8: Create TaskItem component
**File**: `frontend/components/TaskItem.tsx`
**Agent**: Frontend
**Dependencies**: Task 1 (types)

`"use client"` component with:
- Props: `task: Task`, `onToggle`, `onEdit`, `onDelete`
- Displays: title, description (truncated ~150 chars with ellipsis), completion status indicator, creation date (formatted)
- Completed tasks: strikethrough title, muted colors, checkmark
- Checkbox/toggle for completion (loading indicator per-item)
- Edit button → calls `onEdit(task)`
- Delete button → confirmation prompt (`window.confirm`) → calls `onDelete(task.id)`
- Per-item loading indicator during toggle/delete

**Acceptance**: Completed tasks visually distinct. Toggle shows loading. Delete shows confirmation. Description truncated.

---

### Task 9: Create TaskList component
**File**: `frontend/components/TaskList.tsx`
**Agent**: Frontend
**Dependencies**: Task 8 (TaskItem)

`"use client"` component with:
- Props: `tasks: Task[]`, `isLoading: boolean`, `error: string | null`, `onRetry`, `onToggle`, `onEdit`, `onDelete`
- Loading state: skeleton placeholders (3-4 shimmer blocks)
- Error state: error message + "Retry" button
- Empty state: "No tasks yet. Create your first task!" message
- Populated state: renders TaskItem for each task

**Acceptance**: All 4 states render correctly. Retry button calls onRetry. Passes callbacks to TaskItem.

---

### Task 10: Update root page (redirect)
**File**: `frontend/app/page.tsx`
**Agent**: Frontend
**Dependencies**: None

Replace default Next.js content with a client component that:
- Checks auth status via `useAuth()`
- If authenticated → `router.push("/dashboard")`
- If not authenticated → `router.push("/login")`
- Shows loading spinner while checking

**Acceptance**: Authenticated users reach /dashboard. Unauthenticated users reach /login.

---

### Task 11: Create login page
**File**: `frontend/app/login/page.tsx`
**Agent**: Frontend
**Dependencies**: Task 3 (LoginForm)

Page component that:
- Renders LoginForm centered on page
- Redirects authenticated users to /dashboard (via useAuth check)
- Clean, centered layout with app title

**Acceptance**: Renders LoginForm. Redirects authenticated users.

---

### Task 12: Create signup page
**File**: `frontend/app/signup/page.tsx`
**Agent**: Frontend
**Dependencies**: Task 4 (SignupForm)

Page component that:
- Renders SignupForm centered on page
- Redirects authenticated users to /dashboard (via useAuth check)
- Clean, centered layout with app title

**Acceptance**: Renders SignupForm. Redirects authenticated users.

---

### Task 13: Create dashboard protected layout
**File**: `frontend/app/dashboard/layout.tsx`
**Agent**: Frontend
**Dependencies**: None (uses useAuth)

`"use client"` layout that:
- Checks authentication via `useAuth()`
- Redirects to /login if not authenticated
- Shows loading spinner while checking
- Renders children when authenticated

**Acceptance**: Unauthenticated users redirected to /login. Shows loading during check.

---

### Task 14: Create dashboard page
**File**: `frontend/app/dashboard/page.tsx`
**Agent**: Frontend
**Dependencies**: Tasks 2, 5, 6, 7, 8, 9 (API client + all components)

`"use client"` page that orchestrates everything:
- Gets user session via `useAuth()`
- Fetches tasks on mount via `api.getTasks(userId, statusFilter, sortOption)`
- State: `tasks`, `isLoading`, `error`, `statusFilter`, `sortOption`, `editingTask`
- Re-fetches when filter/sort changes
- Handlers for: create task, update task, delete task, toggle complete, edit (sets editingTask)
- Renders: Navbar, TaskForm (create mode, or edit mode if editingTask), TaskFilter, TaskList
- After successful create/update/delete/toggle: refetch tasks list
- Loading/error/empty states handled by TaskList

**Acceptance**: Full CRUD works end-to-end. Filter and sort trigger refetch. Edit mode populates form. All states (loading, error, empty, populated) display correctly.

---

### Task 15: Update root layout metadata
**File**: `frontend/app/layout.tsx`
**Agent**: Frontend
**Dependencies**: None

Update metadata:
- Title: "Todo App" (or similar)
- Description: "Full-stack todo application with task management"

**Acceptance**: Title and description updated from defaults.

---

### Task 16: Create 404 page
**File**: `frontend/app/not-found.tsx`
**Agent**: Frontend
**Dependencies**: None

Simple 404 page with:
- "Page not found" message
- Link to go back to dashboard

**Acceptance**: Displays for unrecognized routes.

---

## Implementation Order (Dependency Chain)

```
Task 1  (types)           ─── no dependencies
Task 2  (api client)      ─── depends on Task 1
Task 3  (LoginForm)       ─── no dependencies
Task 4  (SignupForm)      ─── no dependencies
Task 5  (Navbar)          ─── no dependencies
Task 6  (TaskFilter)      ─── depends on Task 1
Task 7  (TaskForm)        ─── depends on Task 1
Task 8  (TaskItem)        ─── depends on Task 1
Task 9  (TaskList)        ─── depends on Task 8
Task 10 (root page)       ─── no dependencies
Task 11 (login page)      ─── depends on Task 3
Task 12 (signup page)     ─── depends on Task 4
Task 13 (dashboard layout)─── no dependencies
Task 14 (dashboard page)  ─── depends on Tasks 2, 5, 6, 7, 9
Task 15 (root layout)     ─── no dependencies
Task 16 (404 page)        ─── no dependencies
```

**Parallel batches:**
1. Tasks 1, 3, 4, 5, 10, 13, 15, 16 (all independent)
2. Tasks 2, 6, 7, 8, 11, 12 (depend on batch 1)
3. Task 9 (depends on Task 8)
4. Task 14 (depends on batch 2 + 3)

**Recommended sequential order for single-agent execution:**
1 → 2 → 3 → 4 → 5 → 6 → 7 → 8 → 9 → 15 → 16 → 10 → 11 → 12 → 13 → 14

---

## Risk Analysis

1. **Better Auth `token()` method may not work as expected at runtime** — Mitigation: Already implemented in foundation layer (`hooks/useAuth.ts:20-21`), tested pattern. If it fails, fall back to `authClient.getToken()`.

2. **CORS issues between frontend (3000) and backend (8000)** — Mitigation: Backend already has CORS configured for `CORS_ORIGINS`. Verify `http://localhost:3000` is set.

3. **JWT token not available before first API call** — Mitigation: `fetchWithAuth` throws "Not authenticated" if no token; dashboard page handles this by redirecting to login.

---

## Follow-ups

- Testing: Write frontend tests (Vitest + React Testing Library) — deferred to testing feature
- Deployment: Configure Vercel deployment — deferred to later phase
- Performance: Consider SWR/React Query for caching if needed — not required for hackathon scope
